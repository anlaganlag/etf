# ETF滚动策略优化报告

## 测试结果对比

| 策略版本 | T值 | 权重配置 | 止损 | 收益率 | 最大回撤 | 夏普比率 |
|---------|-----|---------|------|--------|---------|---------|
| 原始版本 | 14 | {1:100, 3:70, 5:50, 10:30, 20:20} | 20% | 50.26% | 36.52% | 0.63 |
| **动态仓位★** | 10 | {1:20, 3:30, 5:50, 10:70, 20:100} | 15% | **53.82%** | **27.14%** | **0.81** |
| 激进版本 | 8 | {1:10, 3:20, 5:30, 10:60, 20:150} | 18% | 32.01% | 35.48% | 0.38 |
| 保守版本 | 12 | {1:30, 3:40, 5:50, 10:60, 20:70} | 12% | 58.80% | 32.57% | 0.82 |

## 核心发现

### 1. 权重反转是关键
- 原版：1日权重37%，追涨杀跌
- 优化：20日权重37%，抓住真趋势
- **效果**：收益+3.5%，回撤-9%

### 2. 动态仓位控制有效
市场择时逻辑显著降低回撤：
- 强势市场（60%品种在均线上）：满仓
- 震荡市场（40-60%）：80%仓位
- 弱势市场（<40%）：60%仓位

### 3. 过度激进适得其反
- 极端趋势权重{20:150}降低收益
- T=8换手过快增加成本
- 宽止损18%在震荡市场损失惨重

### 4. 保守版本意外优秀
- T=12更稳定的节奏
- 平衡权重避免过度趋势追逐
- 收益最高58.80%，但回撤略高

## 最终推荐

### 🏆 推荐配置：动态仓位版本（gm_strategy_rolling0.py）

**理由**：
1. **风险调整收益最优**：夏普0.81接近保守版，但回撤更低
2. **回撤控制出色**：27.14%，比原版降低26%
3. **收益稳健**：53.82%年化，在控制回撤基础上实现高收益
4. **适应性强**：动态仓位在不同市场环境自动调整

**适用人群**：
- 追求稳健收益
- 重视回撤控制
- 希望策略自动适应市场环境

### 备选方案：保守版本（gm_strategy_conservative.py）

**适用场景**：
- 追求绝对收益最大化
- 可以承受略高的回撤（32%）
- 偏好更低换手频率

**切换方法**：
```python
REBALANCE_PERIOD_T = 12
periods_rule = {1: 30, 3: 40, 5: 50, 10: 60, 20: 70}
STOP_LOSS = 0.12
```

## 核心优化要素

1. ✅ **权重反转**：长期趋势权重从20分提升至100分
2. ✅ **取消主题限制**：捕捉板块集中爆发机会
3. ✅ **动态仓位**：市场环境自适应调整
4. ✅ **收紧止损**：20% → 15%
5. ✅ **优化换手**：T=14 → T=10

## 性能提升总结

| 指标 | 原版 | 优化版 | 提升幅度 |
|------|------|--------|---------|
| 年化收益 | 50.26% | 53.82% | **+7.1%** |
| 最大回撤 | 36.52% | 27.14% | **-25.7%** |
| 夏普比率 | 0.63 | 0.81 | **+28.6%** |
| 收益/回撤比 | 1.38 | 1.98 | **+43.5%** |

## 结论

通过简单的参数调整（权重反转 + 动态仓位 + 优化换手），策略在**保持收益**的同时**大幅降低回撤**，夏普比率提升近30%。

**当前配置已是最优解**，无需进一步复杂化。


q1:满仓/动态苍梧
两个版本的权衡
  ┌────────────────────┬────────┬────────┬──────┬────────────────────┐
  │        版本        │  收益  │  回撤  │ 夏普 │        特点        │
  ├────────────────────┼────────┼────────┼──────┼────────────────────┤
  │ 保守满仓版（当前） │ 58.80% │ 32.57% │ 0.82 │ 高收益，回撤中等   │
  ├────────────────────┼────────┼────────┼──────┼────────────────────┤
  │ 动态仓位版         │ 53.82% │ 27.14% │ 0.81 │ 收益略低，回撤最优 │
  └────────────────────┴────────┴────────┴──────┴────────────────────┘
  建议
    - 追求绝对收益 → 保持当前配置（58.80%）
    - 追求低回撤 → 恢复动态仓位控制（27%回撤 vs 32%回撤）
                                                                                                差异对比                                                                                                                                      ┌──────────────────┬────────────────────┬─────────────────┬──────────────┐
  │       参数       │      当前版本      │  58.8%保守版本  │     影响     │                                                                  
  ├──────────────────┼────────────────────┼─────────────────┼──────────────┤
  │ 动态仓位         │ ✅ 启用（60-100%） │ ❌ 关闭（满仓） │ 降低收益约5% │
  ├──────────────────┼────────────────────┼─────────────────┼──────────────┤
  │ TRAILING_TRIGGER │ 0.06               │ 0.05            │ 小幅影响     │
  └──────────────────┴────────────────────┴─────────────────┴──────────────┘
  核心问题：你启用了动态仓位控制（gm_strategy_rolling0.py:167-187），在弱势市场只用60%仓位，导致收益降低。

  保守版本58.8%是始终满仓运行的。

  解决方案

  方案1：移除动态仓位，获得58.8%收益

● Read(gm_strategy_rolling0.py)
  ⎿  Read 15 lines
                                                                                                                                              
● Update(gm_strategy_rolling0.py)     
  ⎿  Added 2 lines, removed 5 lines                                                                                                           
      280          targets = ranking_df.head(TOP_N).index.tolist()                                                                                  281                                                                                                                                     
      282          if targets:                                                                                                                      283 -            # 动态仓位控制
                                                                                                                                              
  
      284 -            market_position = get_market_regime(context.prices_df[context.prices_df.index <= current_dt])                          
      285 -            allocate_cash = active_tranche.cash * market_position                                                                  
      286 -            per_amt = allocate_cash / len(targets)                                                                                 
      287 -                                                                                                                                   
      283 +            # 满仓运行（保守版本配置，目标58.8%收益）                                                                              
     

      284 +            per_amt = active_tranche.cash / len(targets)                                                                           
      285              for sym in targets:
      286                  active_tranche.buy(sym, per_amt, price_map.get(sym, 0))
      287

● Update(gm_strategy_rolling0.py)      
  ⎿  Added 1 line, removed 1 line
      13  # --- Simplified Rolling Strategy Config ---                                                                                              14  TOP_N = 5
      15  STOP_LOSS = 0.12  # 收紧止损                                                                                                              
                                                                                                                                              
      16 -TRAILING_TRIGGER = 0.06  # 更早锁定利润
        

      16 +TRAILING_TRIGGER = 0.05  # 保守版本配置                                                                                             
        

      17  TRAILING_DROP = 0.05
      18  MIN_SCORE = 20
      19  REBALANCE_PERIOD_T = 12  # 最优配置（配合动态仓位）



● Bash(cd /d/antigravity/127/etf && python gm_strategy_rolling0.py 2>&1 | tail -10) timeout: 5m 0s
  ⎿  Tranche 10 Guard Sold: ['SHSE.512710']
     Tranche 10 Guard Sold: ['SZSE.159206']                                                                                                   
     Tranche 0 Guard Sold: ['SZSE.159206']
     … +7 lines (ctrl+o to expand)                                                                                                            
                                                                                                                                              ● ✅ 问题解决！                                                                                                                               
                                                                                                                                                现在运行结果：                                                                                                                                Return: 58.80%  ← 达到目标！
  Max DD: 32.57%                                                                                                                              
  Sharpe: 0.82

  原因分析

  你之前的配置混合了两个版本的特性：

  你的配置：
  - ✅ T=12（保守版本）
  - ✅ 权重{1:30→20:70}（保守版本）
  - ✅ 紧止损12%（保守版本）
  - ❌ 动态仓位控制（动态版本的功能）← 这个降低了收益

  动态仓位的影响：
  # 在弱势市场只用60%仓位
  if strength < 0.4: return 0.6

  # 导致：
  错过部分上涨机会 → 收益从58.8%降至约53%

  已修改内容

  1. 移除动态仓位控制 (gm_strategy_rolling0.py:283-286)
  # 改前：根据市场强度调整60-100%仓位
  # 改后：满仓运行
  per_amt = active_tranche.cash / len(targets)
  2. 调整追踪触发 (gm_strategy_rolling0.py:16)
  TRAILING_TRIGGER = 0.05  # 从0.06调至0.05

  两个版本的权衡
  ┌────────────────────┬────────┬────────┬──────┬────────────────────┐
  │        版本        │  收益  │  回撤  │ 夏普 │        特点        │
  ├────────────────────┼────────┼────────┼──────┼────────────────────┤
  │ 保守满仓版（当前） │ 58.80% │ 32.57% │ 0.82 │ 高收益，回撤中等   │
  ├────────────────────┼────────┼────────┼──────┼────────────────────┤
  │ 动态仓位版         │ 53.82% │ 27.14% │ 0.81 │ 收益略低，回撤最优 │
  └────────────────────┴────────┴────────┴──────┴────────────────────┘
  建议

  - 追求绝对收益 → 保持当前配置（58.80%）
  - 追求低回撤 → 恢复动态仓位控制（27%回撤 vs 32%回撤）

  当前配置已是高收益版本，如果你能接受32%的最大回撤，这是最优选择！
