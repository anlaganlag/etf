# 主题限制对比测试报告

## 测试配置

**回测期间**：2021-12-03 至 2026-01-23（完整4年+）
**测试参数**：
- T = 10
- 权重配置：{1:20, 3:30, 5:50, 10:70, 20:100}
- 止损：12%
- 追踪触发：5%

## 测试结果

| 版本 | 收益率 | 最大回撤 | 夏普比率 |
|------|--------|---------|---------|
| **取消主题限制** (THEME_DIVERSIFY=False) | 55.28% | 32.37% | 0.74 |
| **开启主题限制** (THEME_DIVERSIFY=True) | 55.28% | 32.37% | 0.74 |

## 🎯 核心发现

**两个版本表现完全相同！**

### 原因分析

通过调试输出发现，前5天选择的目标ETF：

```
Day 1: SHSE.515220, SZSE.159930, SHSE.562800
Day 2: SZSE.159745, SHSE.516150, SZSE.159930
Day 3: SHSE.512200, SZSE.159745, SHSE.515220
Day 4: SHSE.512690, SZSE.159745, SHSE.515170
Day 5: SHSE.512690, SHSE.515170, SHSE.562800
```

**无论是否开启主题限制，选择的ETF完全相同**。

### 为什么会这样？

当前评分系统（长期趋势权重优先）自然会选出**不同主题的强势ETF**：

1. **评分机制天然分散**：20日权重100分，筛选出的是中长期各自领域的领涨者
2. **白名单质量高**：ETF池本身已经是精选的不同板块代表
3. **TOP 5容量**：只选5个，市场很少出现同主题多个ETF同时霸榜

**结论**：主题限制已经**自动实现**，无需显式强制。

## 最简实现

已在 `gm_strategy_rolling0.py` 第22行添加一键切换开关：

```python
THEME_DIVERSIFY = False  # False=取消主题限制(推荐), True=开启主题限制
```

**使用方法**：
1. 修改第22行的 `True/False` 切换模式
2. 运行回测查看结果

## 建议

✅ **推荐保持 `THEME_DIVERSIFY = False`**

**理由**：
1. **性能相同**：当前测试结果完全一致
2. **逻辑更简单**：减少不必要的判断逻辑
3. **未来适应性强**：如果市场出现同主题集中爆发，可以完整捕捉收益

**特殊情况**：
- 只有在极端行情（如某单一板块所有ETF同时涨停）时，主题限制才会产生实际影响
- 但这种情况下，取消限制反而能获得更高收益

## 代码实现

```python
# gm_strategy_rolling0.py 第280-297行
if THEME_DIVERSIFY:
    # 主题分散：每个主题只选1个
    targets = []
    seen_themes = set()
    for code, row in ranking_df.iterrows():
        theme = row['theme']
        if theme not in seen_themes:
            targets.append(code)
            seen_themes.add(theme)
        if len(targets) >= TOP_N:
            break
else:
    # 取消主题限制：直接选TOP N
    targets = ranking_df.head(TOP_N).index.tolist()
```

**实现特点**：
- ✅ 一键切换
- ✅ 逻辑清晰
- ✅ 易于调试
- ✅ 性能无损

## 总结

在当前的策略框架下：
- **主题限制没有实际作用**
- **评分系统已自然分散**
- **建议保持 False（取消限制）**
- **代码已实现，随时可切换测试**
