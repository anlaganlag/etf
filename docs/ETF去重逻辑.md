**“行为去重” (Behavioral Deduplication)**。

不仅仅依赖“名字/行业分类”来判断是否重复，而是通过计算两个ETF在过去一段时间内（120天）每天收盘价涨跌幅的相似程度来判断，这就是相关性 (Correlation)

不仅仅依赖“名字/行业分类”来判断是否重复，而是通过计算两个ETF在过去一段时间内（120天）每天收盘价涨跌幅的相似程度来判断，这就是相关性 (Correlation)。

算法逻辑具体解释
优先级排序： 首先，我们将通过多因子打分选出的所有候选 ETF 按总分从高到低排序。这一步确保我们总是优先考虑各行业中表现最强的那个“龙头”ETF。
贪婪选择与过滤： 我们从排好序的列表中，逐个尝试选入“Top 10”名单。对于每一个候选 ETF（设为 ETF_Candidate），我们执行以下检查：
相关性扫描 (Correlation Scan)： 系统会拿着 ETF_Candidate 的历史走势，去跟已经入选“Top 10”列表中的每一个 ETF 进行比对。 $$ MaxCorr = \max(Correlation(ETF_{Candidate}, ETF_{Selected_1}), Correlation(ETF_{Candidate}, ETF_{Selected_2}), ...) $$
皮尔逊相关系数 (Pearson Correlation Coefficient)： 这是一个统计学指标，范围是 -1 到 1。
1.0：走势完全同步（你涨1%，我也涨1%）。
0.0：走势完全无关。
-1.0：走势完全相反。
阈值判定 (Threshold Check)：
判定标准：如果 MaxCorr > 0.85。
含义：说明这个候选 ETF 跟我们手里已经持有的某个 ETF 相似度超过 85%。
动作：直接丢弃。因为我们已经有了同类型的更强 ETF，不需要再多买一个走势几乎一样的品种，这会降低资产组合的分散度。
举例说明
假设我们的排序列表前两名是：

NO.1：化工行业ETF易方达（总分 250）
NO.2：化工ETF天弘（总分 250，也是化工）
执行过程：

Step 1：系统先选中 NO.1 化工行业ETF易方达，放入 Top 10。
Step 2：轮到 NO.2 化工ETF天弘。系统计算它与手里已有的（化工易方达）的相关性。
Step 3：计算发现两者相关性高达 0.90 (因为追踪的指数成分股高度重合)。
Step 4：0.90 > 0.85，触发阈值。系统判定 NO.2 为“重复配置”，直接跳过。
Step 5：继续考察 NO.3，直到选满 10 个互不相关的 ETF。
这种算法比单纯靠名字去重更科学，因为它能识别出名字不同但本质相同的 ETF（例如“光伏”和“新能源”往往高度相关，也会被此算法自动分散配置）。