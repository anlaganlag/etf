滚动持仓（Rolling Holdings）的再平衡逻辑，以下是为您整理的详细解答：

核心结论
卖出的仓位大小会直接影响新买入 10 个 ETF 的初始净值。

逻辑解析
通过分析代码（如 compare_rolling_vs_periodic.py）和交易流水（rolling_T14_details_trades.csv），我们可以清晰地看到滚动持仓的运作机制：

资金分片（Independent Tranches）： 策略将初始资金平均分为 T 份（例如 T=14，每份约 7.14%）。每份资金被视为一个独立的“子账户”或“批次”（Tranche）。
批次内部循环（Intra-Tranche Rebalancing）： 每个批次每 T 个交易日进行一次完全换仓。
步骤 A：卖出该批次当前持有的所有 ETF，资金回到该批次的“现金池”。
步骤 B：计算该批次的当前总市值（已结算现金 + 剩余未卖出的残值）。
步骤 C：将该批次的“当前总市值”平分成 10 份，买入新的 10 只 ETF。
收益滚存（Compounding Effect）： 批次之间是不调剂资金的。
如果批次 1 在过去 14 天里大涨了 20%，那么换仓时，它卖出的总金额就会比 14 天前多。
因此，它买入新 10 只 ETF 的每只初始仓位都会比上次增加 20%。
反之，如果亏损，新仓位的初始净值也会同步萎缩。
为什么这样做更稳健？
这种逻辑实现了局部的复利增长（Compound Interest），同时避免了像“定期全仓调仓”那样在某一天全额波动的巨大冲击力。

定期调仓：就像每 12 天把所有水缸里的水倒在一起，再重新平均分。
滚动持仓：就像有 14 个水缸，每天只倒一个缸里的水。水缸里的水越多（赚了钱），重新装满时每份水就越多。
您在交易流水中可以看到，2024年9月初每只买入约 7.1万，到了9月26日第一次换仓时，每只买入已经增长到了 7.7万 左右，这正是前期盈利直接滚入新仓位的体现。

Task
Open
继续探讨这里的:
批次内部循环（Intra-Tranche Rebalancing）： 每个批次每 T 个交易日进行一次完全换仓。
步骤 A：卖出该批次当前持有的所有 ETF，资金回到该批次的“现金池”。
步骤 B：计算该批次的当前总市值（已结算现金 + 剩余未卖出的残值）。
步骤 C：将该批次的“当前总市值”平分成 10 份，买入新的 10 只 ETF。



10支ETF等权
#### 🛡️ 风险控制：天然的“减速带”
*   **逻辑**：当批次市值缩水时，后续新买入的 10 只 ETF 绝对金额随之下降。
*   **价值与意义**：
    1.  **降敞口**：在策略回撤期，自动降低投入市场的绝对资金量（真金白银），减缓净值下跌速度。
    2.  **稳杠杆**：凯利公式告诉我们，风险资产应始终占当前家底的固定比例。这种做法确保了你不会在亏损时因为坚持原始金额而导致“被动放大杠杆”。
    3.  **拒加死码**：本质上是承认当前选股或择时失败，并拒绝在失败的方向上加筹码，符合“截断亏损”的实战生存原则。

---

## 🛑 滚动持仓验证报告 (2026-01-27 更新)

为了验证滚动持仓能否在保持高收益的同时降低回撤，我们开发了独立回测脚本 `gm_rolling_test.py`，模拟了**14个独立分片 (Tranches)** 的每日轮动交易。

### 1. 测试结果对比 (2024.09 - 2026.01)

| 模式 | 配置 | 累计收益 | 最大回撤 | 夏普比率 | 结论 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **基准 A (进取)** | Standard Top 3 | **~195%** | 24.2% | 2.13 | 集中攻击，收益最高 |
| **基准 B (稳健)** | Standard Top 10 | **~112%** | **13.1%** | 1.99 | 空间分散，稳健之王 |
| **实验组** | **Rolling Top 3** | **76.7%** 📉 | 19.3% | 1.67 | **收益腰斩，回撤未降** |

### 2. 深度归因：为什么滚动持仓失效？

实验结果显示，滚动持仓 (Rolling Top 3) 的表现**全面劣于**标准稳健版 (Standard Top 10)。这揭示了 A 股 ETF 轮动策略的一个核心特征：

*   **爆发窗口短 (Alpha Decay)**: 本策略的核心 Alpha 来自 "Theme Boost" 捕捉的板块爆发（如半导体、券商），这种爆发往往在 **3-5 天内** 完成主升浪。
*   **速度错配**:
    *   **Standard (T=14)**: 如果你在爆发前夜满仓切入，能吃到完整的主升浪 (如 195% 的由来)。
    *   **Rolling (T=14)**: 每天只切入 1/14 的仓位。等到第 14 天你终于建完仓时，该板块的主升浪可能已经结束甚至开始回调。**"慢"是动量策略的致命伤。**
*   **分散的双面性**:
    *   **空间分散 (Top 10)**: 同一时间持有 10 个板块，东方不亮西方亮，能有效平滑波动 (MDD 13%)。**(胜)**
    *   **时间分散 (Rolling)**: 同一板块分 14 天买，结果是平摊了成本，但也平摊(稀释)了爆发力。在 A 股这种"脉冲式"行情中，时间分散往往意味着"错过最佳上车点"。

### 3. 最终建议

**❌ 否决滚动持仓方案**。
理由：它以极大的执行复杂度（每日操作）和巨大的收益损失（从 195% 降至 76%）为代价，却未能提供优于 Top 10 的风控效果（19% vs 13% 回撤）。

**✅ 推荐方案**：
保持 **Standard Top 10 (稳健版)**。如果追求高收益，建议直接调整仓位至 **Standard Top 5**，而不是使用滚动持仓。

### 4. 近期高频对比验证 (2025.11.21 - 2026.01.23)

为了回应关于“滚动持仓在特定震荡区间是否更优”的疑问，我们对最近 2 个月的行情进行了 T=8 到 T=14 的全参数扫描：

| 周期 (T) | Periodic (一次性) 收益 | **Rolling (滚动) 收益** | 差异 (Diff) | 现象解读 |
| :--- | :--- | :--- | :--- | :--- |
| **T=8** | 14.47% | **33.19%** | +18.72% | 定期调仓踏空，滚动胜出 |
| **T=10** | 2.86% | **34.46%** | **+31.60%** | **运气最差案例**：定期调仓在回调前高位接盘 |
| **T=12** | **34.91%** | 30.30% | -4.61% | 定期调仓运气好，踩中节奏 |
| **T=14** | **38.29%** | 29.99% | -8.30% | 定期调仓运气爆棚，收益最高 |

**深度结论**：
1.  **定期调仓 (Periodic) 是“赌大小”**：可以看到其收益在 **2.86%** 到 **38.29%** 之间剧烈波动。这就是“运气成分”。如果你的 T=10，这几个月你会非常痛苦 (2.86%)。
2.  **滚动持仓 (Rolling) 是“稳拿平均分”**：无论 T 是多少，收益都稳定在 **30% - 34%** 之间。它消除了“入场日运气”的影响。
3.  **决策两难**：
    *   如果你相信自己运气好（或者愿意赌），Periodic 天花板更高。
    *   如果你想**并在实盘中睡得着觉**，Rolling 提供了极高的**一致性**，避免了“T=10 惨案”的发生。虽然全周期看它跑输了 T=14 Periodic (76% vs 195%)，但在特定局部区间，它救了 T=10 策略一命。

### 5. 中期全景对比 (2025.06.23 - 2026.01.23)

为了全面评估参数敏感性，我们对 **T=6 到 T=14** 进行了全覆盖测试，结果揭示了定期调仓的巨大隐患：

| 周期 (T) | Periodic (一次性) 收益 | **Rolling (滚动) 收益** | 差异 (Diff) | 现象解读 |
| :--- | :--- | :--- | :--- | :--- |
| **T=6** | 46.55% | 50.09% | +3.55% | - |
| **T=7** | 7.36% | 53.12% | **+45.76%** | Periodic 严重踏空 |
| **T=8** | 91.22% | 52.59% | -38.64% | Periodic 表现优异 |
| **T=9** | 51.18% | 57.20% | +6.03% | - |
| **T=10** | **99.44%** 🚀 | 56.44% | -43.00% | Periodic 翻倍 (运气最佳) |
| **T=11** | 13.18% | 52.04% | +38.87% | Periodic 低迷 |
| **T=12** | 79.58% | 49.12% | -30.46% | Periodic 表现不错 |
| **T=13** | 42.54% | 47.49% | +4.95% | - |
| **T=14** | **-2.29%** 📉 | 49.52% | **+51.81%** | **Periodic 灾难性亏损** |

**数据洞察**：
1.  **定期调仓 (Periodic) 的“过山车”**：收益率分布在 **-2.29%** 到 **99.44%** 之间。极差超过 100%！这说明 Periodic 策略的胜负完全取决于“设定的 T 值是否碰巧契合了市场节奏”。
2.  **滚动持仓 (Rolling) 的“定海神针”**：无论 T 取何值，收益率极其稳定地落在 **47% - 57%** 的狭窄区间内。**标准差极小**。

**最终战略建议**：
*   **小资金/个人用户**：如果你的风险承受力强，且坚信 T=14 回测长期有效，请坚持 **Periodic Top 10** (稳健) 或 Top 3 (博命)。
*   **大资金/产品户**：**必须上 Rolling**。因为你无法向客户解释，为什么隔壁老王 (T=10) 赚了 99%，而你 (T=14) 亏了 2%。Rolling 能确保你永远拿到“市场平均优秀”的成绩 (50%)，而不是去赌那 0% 或 100% 的概率。

### 6. 短中期滑动窗口验证 (1M - 6M)

为了更细致地观察两种策略在不同时间跨度下的表现（截止 2026.01.23），我们进行了逐月回溯测试 (Rolling Window Analysis)：

| 回溯时长 | 起始日期 | Periodic (T=14) | Rolling (T=14) | 差异 (Diff) | 状态解读 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **1个月** | 2025.12.23 | **25.78%** | 12.40% | -13.38% | Periodic 这种突击战更强 |
| **2个月** | 2025.11.23 | **38.29%** | 29.99% | -8.30% | Periodic 延续优势 |
| **3个月** | 2025.10.23 | **35.57%** | 20.68% | -14.90% | Periodic 踩中节奏 |
| **4个月** | 2025.09.23 | 7.77% 📉 | **20.12%** | **+12.35%** | **Periodic 踏空/回撤期，Rolling 防御生效** |
| **5个月** | 2025.08.23 | 27.49% | **30.26%** | +2.77% | 双方持平，Rolling 略优 |
| **6个月** | 2025.07.23 | **116.92%** 🚀 | 44.04% | -72.88% | **Periodic 捕捉到了之前的超级主升浪** |

**深度特征画像**：

1.  **Periodic (定期调仓) 是“狙击手”**：
    *   在 **6个月** 的长周期里，它抓住了一波超级行情，收益率飙升到 **116%**。
    *   但在 **4个月** 这种特定的震荡下行期，它的收益骤降到了 **7.77%**。
    *   特征：**要么不开张，开张吃三年**。

2.  **Rolling (滚动持仓) 是“机枪手”**：
    *   它没有捕捉到 116% 的极端暴利，但在所有时间窗口里（1M~6M），它的收益从未低于 **12%**，最差也有 **20%**。
    *   特别是在 Periodic 表现最差的 **4个月** 窗口 (Sep-Jan)，Rolling 依然稳稳拿到了 **20.12%** 的收益，是对方的近 3 倍。
    *   特征：**输出平滑，从不哑火，但也别指望一枪爆头**。

这再次验证了我们的核心观点：**资金属性决定策略选择**。想要暴利选 Periodic，想要稳健复利选 Rolling。


