策略方案深度评价报告

  一、核心发现：文档与实现的严重背离 ⚠️

  1.1 评分机制的根本性差异

  文档声称：
  - 在全市场1700+只ETF中排名
  - 进入全市场前15名才得分
  - 这是"绝对领先者"的筛选逻辑

  实际代码实现（etf_ranker.py:148）：
  top_indices = df_res[col].sort_values(ascending=False).index[:threshold]
  - 只在候选池150只ETF内部排名
  - 进入候选池前15名就得分（前10%）
  - 这是"矮子里拔将军"的逻辑

  影响：这是两个完全不同的策略。候选池内Top 10%远比全市场Top 1%容易达到。

  ---
  1.2 Score≥150门槛：不存在的"择时功能"

  文档声称：
  - Score≥150作为入场门槛
  - 弱市自动空仓（27%空仓比例）
  - 这是核心的"自动择时"逻辑

  实际代码（backtest.py:101-106）：
  top_df = ranker.select_top_etfs(df_candidates, top_n=10, ...)
  if not top_df.empty:
      selected_codes = top_df['etf_code'].tolist()
  - 完全没有Score门槛检查
  - 永远满仓买入Top 10
  - 从未空仓

  验证：查看backtest_result.csv，每天都持有10只ETF，0%空仓率。

  ---
  1.3 参数配置不一致
  ┌──────────┬───────────────────────────┬───────────────────────────┐
  │   项目   │         文档描述          │ 实际配置(config.py:22-29) │
  ├──────────┼───────────────────────────┼───────────────────────────┤
  │ 评分周期 │ 8个(R1-R250)              │ 6个(R1-R60)               │
  ├──────────┼───────────────────────────┼───────────────────────────┤
  │ 缺失周期 │ -                         │ R120、R250未配置          │
  ├──────────┼───────────────────────────┼───────────────────────────┤
  │ 权重表   │ 包含R120(10分)、R250(5分) │ 不存在                    │
  └──────────┴───────────────────────────┴───────────────────────────┘
  ---




  2.3 Score门槛的"事后诸葛亮"

  post924_analysis.csv揭示的真相：
  ┌─────────────┬──────────────────────┬────────────────────┐
  │    策略     │ Full Period (9-01起) │ Post-924 (11-01起) │
  ├─────────────┼──────────────────────┼────────────────────┤
  │ 无门槛(T20) │ +128%                │ +64%               │
  ├─────────────┼──────────────────────┼────────────────────┤
  │ Score≥150   │ +57%                 │ +152%              │
  └─────────────┴──────────────────────┴────────────────────┘
  解读：
  - 9-10月份（924行情暴涨期）：Score≥150门槛导致错失大涨（57% vs 128%）
  - 11月后（回调期）：Score≥150门槛成功避险（+152% vs +64%）

  问题：
  - Score=150这个阈值是事后优化出来的"完美参数"
  - 它恰好避开了回测期内的特定回调
  - 这是典型的过拟合，未来大概率失效

  ---
  三、策略逻辑的理论缺陷

  3.1 "精选池+全市场排名"的矛盾

  逻辑链声称：
  1. 先用精选池(150只)过滤垃圾ETF
  2. 再用全市场排名确保"绝对领先"

  实际问题：
  - 如果精选池已经是"好赛道"，为何还需要全市场排名？
  - 如果全市场排名有效，为何需要精选池限制？
  - 两层筛选的有效性互相削弱

  ---
  3.2 评分权重的任意性
  ┌──────┬───────┬────────────────────────┐
  │ 周期 │ 权重  │       逻辑依据？       │
  ├──────┼───────┼────────────────────────┤
  │ R1   │ 100分 │ 为何是100不是80或120？ │
  ├──────┼───────┼────────────────────────┤
  │ R3   │ 70分  │ 为何是70不是60或80？   │
  ├──────┼───────┼────────────────────────┤
  │ R20  │ 20分  │ ...                    │
  └──────┴───────┴────────────────────────┘
  问题：文档未提供任何理论或实证依据，这些权重缺乏可验证性。

  ---
  3.3 T=20持仓周期的合理性存疑

  文档理由："A股热点周期约1个月"

  反驳：
  - 没有数据支持"A股热点周期=1个月"这一论断
  - 热点周期高度依赖市场环境（牛市快、熊市慢）
  - 参数扫描显示T=10~30收益差异不大，说明该参数不稳健

  ---
  四、关键风险与未验证问题

  4.1 过拟合风险：极高 🔴
  ┌───────────────────────┬──────────┐
  │        风险点         │ 严重程度 │
  ├───────────────────────┼──────────┤  
  │ 样本期特殊（924行情） │ 🔴 极高  │
  ├───────────────────────┼──────────┤
  │ Score门槛事后优化     │ 🔴 极高  │
  ├───────────────────────┼──────────┤
  │ 参数未经样本外验证    │ 🔴 极高  │
  └───────────────────────┴──────────┘
  ---
  4.2 未验证的关键假设



  1. 交易成本：
    - 文档称"交易费用影响-0.3%"，依据何在？



  ---
  五、数据验证方案

  5.1 必须完成的验证（优先级P0）

● Write(docs\strategy_validation_plan.md)
  ⎿  Wrote 1 lines to docs\strategy_validation_plan.md
     # 策略验证方案                              
     ## 一、必须完成的验证（P0）
     ### 1. 修复策略实现与文档的差异                                                                      **当前问题**：代码实现与文档描述完全不同
     **验证步骤**：                                                                                  
     ```python
     # 1. 实现真正的"全市场排名"评分
     def calculate_market_wide_score(etf_code, all_etf_returns):


  ---                                                                                                  🎯 核心结论
                                                                                                     
  这个策略方案存在三个致命缺陷：

  1. 📝 文档与代码完全不符（诚信问题）

  - 文档承诺："全市场1700+只ETF排名" + "Score≥150择时"
  - 实际代码：候选池内部排名 + 永远满仓
  - 这不是实现bug，而是两个完全不同的策略

  2. 📊 数据过拟合达到危险级别
  ┌───────────────────┬─────────┬───────────────┐
  │       问题        │ 严重性  │     影响      │
  ├───────────────────┼─────────┼───────────────┤  
  │ Score=150事后优化 │ 🔴 极高 │ 未来必失效    │
  ├───────────────────┼─────────┼───────────────┤
  │ 实际是否跑赢创业板   │ 🔴 极高 │ 无alpha证据   │
  └───────────────────┴─────────┴───────────────┘



  思考:
  1. Score≥150门槛在大部分时期会错失机会
  2. 动量策略在震荡市表现极差（2023年可能-20%）












----------------------


  关于"用数据验证"

  我刚刚已经用数据验证了：
  - 运行test_timing_unified.py → +123.8%
  - 运行test_post924.py → +133.7%（Weak List）
  - 运行test_score_threshold.py → 最优是180（+156.3%），不是150

  数据证明：策略在Post-924有效，但：
  1. 最优参数不是150
  2. 不同时段表现波动大
  3. 需要更长周期验证
